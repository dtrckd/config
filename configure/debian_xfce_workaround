# A lot of issue resolve in the Arch Wiki:  https://wiki.archlinux.org/index.php/Xfce

# SSD ata erroor (ddry, timeout, freeze etc)
# https://wiki.archlinux.org/index.php/Solid_State_Drives#Resolving_NCQ_errors
echo 1 > /sys/block/sda/device/queue_depth
# Or
#GRUB_CMDLINE_LINUX="libata.force=noncq" # In /etc/default/grub
#aptitude  install  firmware-linux-nonfree
### !!! comment amd64-microcode in modprobe blacklist !!!


# If using xfce4-power-manager to control ACPI events, and not systemd >> /etc/systemd/logind.conf:
HandlePowerKey=ignore
HandleSuspendKey=ignore
HandleHibernateKey=ignore
HandleLidSwitch=ignore

# Fix black creen after unlock, after resume
# This solution works on my laptop (ubuntu 16.04, but should work on previous OS):
#    open as root file /etc/UPower/UPower.conf
#    change IgnoreLid=false ==> IgnoreLid=true
#    save changes, restart system and now it works :-)
#    You can remove light-locker now.

# Hibernation workaround >> /etc/pm/sleep.d/00...
#!/bin/sh
case "$1" in
suspend)
;;
resume)
sleep 0.1
vbetool dpms off
vbetool dpms on
;;
*) exit $NA
;;
esac

# Disable beep >> ~/.gtkrc-2.0
# see also: blacklist pcspkr
gtk-error-bell = 0


#Transparent background for icon titles >> ~/.gtkrc-2.0:
style "xfdesktop-icon-view" {
    # transparent background
    XfdesktopIconView::label-alpha = 0

    # white font
    base[NORMAL] = "#ffffff"
    base[SELECTED] = "#5D97D1"
    base[ACTIVE] = "#5D97D1"
    fg[NORMAL] = "#ffffff"
    fg[SELECTED] = "#ffffff"
    fg[ACTIVE] = "#ffffff"
}
widget_class "*XfdesktopIconView*" style "xfdesktop-icon-view"

# Missing Icons
icontheme=/usr/share/icons/gnome
ln -s /usr/share/icons/hicolor/16x16/actions/xfpm-suspend.png   ${icontheme}/16x16/actions/system-suspend.png
ln -s /usr/share/icons/hicolor/16x16/actions/xfpm-hibernate.png ${icontheme}/16x16/actions/system-hibernate.png
ln -s /usr/share/icons/hicolor/22x22/actions/xfpm-suspend.png   ${icontheme}/22x22/actions/system-suspend.png
ln -s /usr/share/icons/hicolor/22x22/actions/xfpm-hibernate.png ${icontheme}/22x22/actions/system-hibernate.png
ln -s /usr/share/icons/hicolor/24x24/actions/xfpm-suspend.png   ${icontheme}/24x24/actions/system-suspend.png
ln -s /usr/share/icons/hicolor/24x24/actions/xfpm-hibernate.png ${icontheme}/24x24/actions/system-hibernate.png
ln -s /usr/share/icons/hicolor/48x48/actions/xfpm-suspend.png   ${icontheme}/48x48/actions/system-suspend.png
ln -s /usr/share/icons/hicolor/48x48/actions/xfpm-hibernate.png ${icontheme}/48x48/actions/system-hibernate.png

# Windows buttons stop working and just blinking:
xfwm4 --replace &

# Panel with windows and worspace don't respond:
xfce4-panel -r

# SIOCSIFFLAGS: Operation not possible due to RF-kil
rfkill unblock wifi
rfkill unblock all

# better touchpad thinkpad (X220,), synclient -l # error, cant figure it out ?
aptitude install xserver-xorg-input-synaptics xserver-xorg-input-libinput
#gsettings set org.gnome.desktop.peripherals.touchpad send-events 'enabled'


# Propagate new xfce4 conf (at least panel)
xfce4-panel --quit ; sudo pkill xfconfd ; rm -rf ~/.config/xfce4/panel ~/.config/xfce4/xfconf/xfce-perchannel-xml/xfce4-panel.xml ; (copy from cponfig/dotfiles/.config/xfce4; xfce4-panel;
# Other way to propagate xfconf:
xfdesktop --reload

# Enable Brave
echo 1 > /proc/sys/kernel/unprivileged_userns_clone

# Desactivate automatic upgrade
sudo systemctl mask unattended-upgrade.service

# reboot sound,a al
pulseaudio -k && sudo alsa force-reload

